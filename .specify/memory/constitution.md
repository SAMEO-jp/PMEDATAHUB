<!--
  同期影響レポート:
  バージョン変更: [新規] → 1.0.0
  変更された原則: なし（初回版）
  追加セクション: 全ての基本原則とガバナンスセクション
  削除セクション: なし（初回版）
  更新が必要なテンプレート:
    ✅ .specify/templates/plan-template.md（更新不要 - 憲章を汎用的に参照）
    ✅ .specify/templates/spec-template.md（更新不要 - 憲章パターンに従う）
    ✅ .specify/templates/tasks-template.md（更新不要 - 憲章と互換性あり）
  フォローアップTODO: なし
-->

# PMEDATAHUB 憲章

## 基本原則

### I. フルスタック型安全性
データベースからUIまで、エンドツーエンドの型安全性を維持することが必須。TypeScript strict モードは交渉不可。tRPCがAPI境界での型安全性を保証。サードパーティ統合の厳密に制御された場合を除き、プロダクションコードでの`any`型は禁止。

**根拠**: 型安全性は実行時エラーを防ぎ、開発者体験を向上させ、複雑なプロジェクト管理ワークフロー全体でのデータ整合性を保証する。

### II. コンポーネント優先アーキテクチャ
全てのUI機能はshadcn/uiパターンを使用した再利用可能なコンポーネントから始める。コンポーネントは自己完結型で、独立してテスト可能で、適切なTypeScriptインターフェースで文書化されている必要がある。再利用のために抽出できないページ固有のコンポーネントは禁止。

**根拠**: PMEDATAHUBは写真、パレット、BOM、プロジェクトタイムラインの一貫した再利用可能なUIパターンを必要とする複雑なプロジェクトデータ可視化を扱う。

### III. データベース優先データモデリング
全てのデータ構造はSQLiteスキーマ設計から始める。スキーマ変更には適切なマイグレーションが必須。データ整合性制約はアプリケーションコードだけでなく、データベースレベルで強制される。

**根拠**: プロジェクト管理データには参照整合性と一貫したデータモデリングを必要とする複雑な関係（プロジェクト、写真、パレット、BOM）がある。

### IV. APIコントラクトテスト
全てのtRPCエンドポイントには入出力タイプと動作を定義するコントラクトテストが必須。既存APIへの破壊的変更にはバージョニングとマイグレーションパスが必要。API変更は同じコミットでドキュメント更新が必要。

**根拠**: 複数の機能が共有API（写真管理、プロジェクトデータ、パレット追跡）に依存しており、安定した明確に定義されたコントラクトが必要。

### V. パフォーマンス優先実装
プロジェクト一覧と写真ギャラリーのページロード時間は2秒以内を維持必須。データベースクエリは適切なインデックスを使用必須。画像読み込みは適切なサムネイルと遅延読み込みでプログレッシブエンハンスメントを実装。

**根拠**: PMEDATAHUBは大容量の写真コレクションと複雑なプロジェクトデータを扱うため、実用的な使いやすさのために最適化されたパフォーマンスが必要。

## 開発基準

### コード品質
- ESLintとTypeScript strict モードを全てのコミットで強制
- 重要なビジネスロジックのコードカバレッジを80%以上に維持
- 全ての公開関数をJSDocコメントで文書化
- コンポーネントプロパティとAPIレスポンスを完全に型付け

### ファイル組織
- 機能ベースの組織化を持つNext.js App Router構造
- ドメイン別コンポーネントグループ化（写真、プロジェクト、パレットなど）
- 適切なTypeScriptエクスポートを持つ`/lib`の共有ユーティリティ
- 適切な接続管理を持つ`/lib/db`でのデータベース操作の分離

### テスト要件
- ビジネスロジックとユーティリティ関数の単体テスト
- データベース操作とAPIエンドポイントの統合テスト
- 重要なユーザーワークフロー（写真アップロード、プロジェクト作成）のE2Eテスト
- UIコンポーネントとレスポンシブデザインの手動テストチェックリスト

## 技術制約

### 技術スタック
- **フロントエンド**: Next.js 14 App Router、TypeScript、TailwindCSS、shadcn/ui
- **バックエンド**: tRPC、適切なインデックス付きSQLite
- **状態管理**: クライアント状態にZustand、サーバー状態にtRPC
- **ファイルストレージ**: `/public/demopic/`下の構造化された組織でのローカルファイルシステム

### セキュリティ要件
- Zodスキーマを使用した全てのAPIエンドポイントでの入力検証
- ファイルアップロード制限（サイズ制限、タイプ検証、サニタイゼーション）
- 機密システム情報を露出しない適切なエラーハンドリング
- データベース接続の適切なセキュリティと管理

### パフォーマンス基準
- Next.js Imageコンポーネントでの画像自動最適化
- 適切なインデックスでのデータベースクエリ最適化
- バンドルサイズの監視と合理的な制限の維持
- 大容量写真コレクションのプログレッシブロード

## ガバナンス

### 憲章権限
この憲章は他の全ての開発実践とガイドラインに優先する。この文書と他のドキュメントとの間で矛盾が生じた場合、この憲章が優先される。

### 修正プロセス
憲章変更には以下が必要:
1. 提案された変更と根拠の文書化
2. 既存コードベースとテンプレートへの影響評価
3. セマンティックバージョニングに従ったバージョンアップ
4. 依存テンプレートとドキュメントの更新

### コンプライアンス検証
全てのプルリクエストは憲章コンプライアンスを検証必須:
- エンドツーエンドの型安全性維持
- コンポーネントパターンの確立された慣例への準拠
- データベース変更の適切なマイグレーション包含
- API変更のコントラクトテスト包含
- 大容量データシナリオでのパフォーマンス影響評価

### 実行時ガイダンス
開発者は日常の開発ガイダンスとプロジェクト固有のコマンドについて`/CLAUDE.md`を参照すべき。憲章は不変の原則を提供し、CLAUDE.mdは実用的な実装詳細を提供する。

**バージョン**: 1.0.0 | **批准**: 2025-10-17 | **最終修正**: 2025-10-17
# Week Shiwake ãƒ‡ãƒ¼ã‚¿å‹æ•´ç†ä»•æ§˜æ›¸

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€`week-shiwake/[year]/[week]`ãƒ•ã‚©ãƒ«ãƒ€ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã®æ•´ç†ã¨çµ±ä¸€ã‚’å®šç¾©ã—ã¾ã™ã€‚ç¾åœ¨ã®å‹å®šç¾©ã®é‡è¤‡ã€ä¸æ•´åˆã€`any`å‹ã®å¤šç”¨ã‚’è§£æ±ºã—ã€å‹å®‰å…¨æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

## ğŸ¯ ç¾çŠ¶ã®å•é¡Œç‚¹

### 1. å‹å®šç¾©ã®é‡è¤‡ã¨ä¸æ•´åˆ

#### ã‚¤ãƒ™ãƒ³ãƒˆé–¢é€£ã®å‹
- **`EventItem`** (types/event.ts) - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ç”¨
- **`ClientEvent`** (types/event.ts) - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¡¨ç¤ºç”¨
- **`WeekEvent`** (page.tsxå†…) - ãƒ­ãƒ¼ã‚«ãƒ«å®šç¾©ï¼ˆé‡è¤‡ï¼‰
- **`ServerEvent`** (ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ) - æœªä½¿ç”¨
- **`BaseEvent`** (__ignore__ãƒ•ã‚©ãƒ«ãƒ€) - åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‹

#### å‹ã®ä¸æ•´åˆ
```typescript
// å•é¡Œ1: WeekEventã¨ClientEventã®æ··åœ¨
interface WeekEvent {
  [key: string]: unknown; // å‹å®‰å…¨æ€§ã®æ¬ å¦‚
  // ... ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
}

interface ClientEvent {
  // å³å¯†ãªå‹å®šç¾©
  // [key: string]: unknown ãŒãªã„
}
```

### 2. `any`å‹ã®å¤šç”¨

#### ç¾åœ¨ã®`any`å‹ä½¿ç”¨ç®‡æ‰€
```typescript
// hooks/useWeekData.ts
const [employees, setEmployees] = useState<any[]>([])
const [projects, setProjects] = useState<any[]>([])

// hooks/useResizeEvent.ts
events: any[]
setEvents: React.Dispatch<React.SetStateAction<any[]>>

// lib/client-db.ts
export async function saveWeekAchievements(year: number, week: number, events: any[])

// components/TimeGrid.tsx
events: any[]

// lib/weekDataManager.ts
events: any[]
workTimes: any[]
```

### 3. å‹å¤‰æ›ã®è¤‡é›‘æ€§

#### ç¾åœ¨ã®å‹å¤‰æ›ãƒ•ãƒ­ãƒ¼
```typescript
// ã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
EventItem â†’ ClientEvent (formatEventForClient)

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼
ClientEvent â†’ EventItem (formatEventForServer)

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
ClientEvent[] â†” localStorage
```

## ğŸ”§ çµ±ä¸€ã•ã‚ŒãŸå‹å®šç¾©

### 1. åŸºæœ¬å‹å®šç¾©

#### 1.1 å…±é€šãƒ™ãƒ¼ã‚¹å‹
```typescript
// types/base.ts
export interface BaseEntity {
  id: string;
  keyID: string;
  employeeNumber: string;
  createdAt?: string;
  updatedAt?: string;
}

export interface BaseEvent extends BaseEntity {
  startDateTime: string;
  endDateTime: string;
  subject: string;
  content?: string;
  projectNumber?: string;
  type?: string;
  position?: string;
  facility?: string;
  status?: string;
  organizer?: string;
  businessCode?: string;
  departmentCode?: string;
  weekCode?: string;
  classification1?: string;
  classification2?: string;
  classification3?: string;
  classification4?: string;
  classification5?: string;
  classification6?: string;
  classification7?: string;
  classification8?: string;
  classification9?: string;
}
```

#### 1.2 ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‹
```typescript
// types/server.ts
export interface ServerEvent extends BaseEvent {
  // ã‚µãƒ¼ãƒãƒ¼å›ºæœ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
  oldId?: string; // æ›´æ–°æ™‚ã®å…ƒID
}

export interface ServerAchievement extends ServerEvent {
  // å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿å›ºæœ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
}

export interface ServerWorkTime {
  date: string;
  startTime?: string;
  endTime?: string;
  employeeNumber: string;
  year: number;
  week: number;
}
```

#### 1.3 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å‹
```typescript
// types/client.ts
export interface ClientEvent extends BaseEvent {
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¡¨ç¤ºç”¨ã®è¿½åŠ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
  title: string;
  description: string;
  project: string;
  category: string;
  color: string;
  top: number;
  height: number;
  unsaved?: boolean;
  activityCode?: string;
  activityRow?: string;
  activityColumn?: string;
  activitySubcode?: string;
  equipmentNumber?: string;
}

export interface ClientWorkTime {
  date: string;
  startTime?: string;
  endTime?: string;
  isDefault?: boolean;
}

export interface ClientUser {
  employeeNumber: string;
  name: string;
  department?: string;
  position?: string;
}

export interface ClientProject {
  id: string;
  name: string;
  number: string;
  category?: string;
  color?: string;
}

export interface ClientEmployee {
  employeeNumber: string;
  name: string;
  department?: string;
  position?: string;
  isActive?: boolean;
}
```

### 2. çŠ¶æ…‹ç®¡ç†å‹

#### 2.1 UIçŠ¶æ…‹å‹
```typescript
// types/ui.ts
export interface UIState {
  // ã‚¿ãƒ–é–¢é€£
  selectedTab: 'project' | 'indirect' | 'purchase';
  selectedProjectSubTab: string;
  indirectSubTab: string;
  
  // ã‚¤ãƒ™ãƒ³ãƒˆé¸æŠ
  selectedEvent: ClientEvent | null;
  activeEvent: ClientEvent | null;
  
  // ä¿å­˜çŠ¶æ…‹
  isSaving: boolean;
  hasChanges: boolean;
  isCtrlPressed: boolean;
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  saveMessage: SaveMessage | null;
  apiError: string | null;
}

export interface SaveMessage {
  type: 'success' | 'error' | 'warning' | 'info';
  text: string;
  duration?: number;
}
```

#### 2.2 ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹å‹
```typescript
// types/data.ts
export interface WeekDataState {
  // åŸºæœ¬ãƒ‡ãƒ¼ã‚¿
  events: ClientEvent[];
  workTimes: ClientWorkTime[];
  
  // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
  employees: ClientEmployee[];
  projects: ClientProject[];
  currentUser: ClientUser;
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  year: number;
  week: number;
  loading: boolean;
  apiError: string | null;
}

export interface WeekData {
  year: number;
  week: number;
  events: ClientEvent[];
  workTimes: ClientWorkTime[];
}
```

### 3. APIå‹

#### 3.1 APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹
```typescript
// types/api.ts
export interface APIResponse<T> {
  success: boolean;
  data: T;
  message?: string;
  error?: string;
}

export interface SaveWeekDataRequest {
  year: number;
  week: number;
  events: ServerEvent[];
}

export interface DeleteEventRequest {
  keyID: string;
}

export interface GetWeekDataResponse {
  events: ServerEvent[];
  workTimes: ServerWorkTime[];
}
```

## ğŸ”„ å‹å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

### 1. ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ›
```typescript
// utils/typeConverters.ts
export function convertToClientEvent(serverEvent: ServerEvent): ClientEvent {
  const startTime = new Date(serverEvent.startDateTime);
  const endTime = new Date(serverEvent.endDateTime);
  
  const top = startTime.getHours() * 64 + (startTime.getMinutes() / 60) * 64;
  const duration = (endTime.getTime() - startTime.getTime()) / 60000;
  const height = (duration / 60) * 64;
  
  return {
    ...serverEvent,
    title: serverEvent.subject,
    description: serverEvent.content || '',
    project: serverEvent.projectNumber || '',
    category: serverEvent.type || '',
    color: getEventColor(serverEvent.type),
    top,
    height,
    unsaved: false,
  };
}

export function convertToServerEvent(clientEvent: ClientEvent): ServerEvent {
  return {
    ...clientEvent,
    subject: clientEvent.title,
    content: clientEvent.description,
    projectNumber: clientEvent.project,
    type: clientEvent.category,
  };
}
```

### 2. å‹¤å‹™æ™‚é–“å¤‰æ›
```typescript
// utils/workTimeConverters.ts
export function convertToClientWorkTime(serverWorkTime: ServerWorkTime): ClientWorkTime {
  return {
    date: serverWorkTime.date,
    startTime: serverWorkTime.startTime,
    endTime: serverWorkTime.endTime,
  };
}

export function convertToServerWorkTime(clientWorkTime: ClientWorkTime, employeeNumber: string, year: number, week: number): ServerWorkTime {
  return {
    ...clientWorkTime,
    employeeNumber,
    year,
    week,
  };
}
```

## ğŸ“Š å‹å®‰å…¨æ€§ã®å‘ä¸Š

### 1. `any`å‹ã®ç½®ãæ›ãˆ

#### Before
```typescript
// hooks/useWeekData.ts
const [employees, setEmployees] = useState<any[]>([]);
const [projects, setProjects] = useState<any[]>([]);

// lib/client-db.ts
export async function saveWeekAchievements(year: number, week: number, events: any[])
```

#### After
```typescript
// hooks/useWeekData.ts
const [employees, setEmployees] = useState<ClientEmployee[]>([]);
const [projects, setProjects] = useState<ClientProject[]>([]);

// lib/client-db.ts
export async function saveWeekAchievements(year: number, week: number, events: ServerEvent[])
```

### 2. å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯

#### Before
```typescript
// page.tsx
const [selectedEvent, setSelectedEvent] = useState<any>(null);
const handleEventClick = (event: any) => {
  setSelectedEvent(event);
};
```

#### After
```typescript
// page.tsx
const [selectedEvent, setSelectedEvent] = useState<ClientEvent | null>(null);
const handleEventClick = (event: ClientEvent) => {
  setSelectedEvent(event);
};
```

## ğŸš€ å®Ÿè£…è¨ˆç”»

### Phase 1: åŸºæœ¬å‹å®šç¾©ã®ä½œæˆ
1. **`types/base.ts`** - å…±é€šãƒ™ãƒ¼ã‚¹å‹ã®å®šç¾©
2. **`types/server.ts`** - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‹ã®å®šç¾©
3. **`types/client.ts`** - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å‹ã®å®šç¾©
4. **`types/ui.ts`** - UIçŠ¶æ…‹å‹ã®å®šç¾©
5. **`types/data.ts`** - ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹å‹ã®å®šç¾©
6. **`types/api.ts`** - APIå‹ã®å®šç¾©

### Phase 2: å‹å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ä½œæˆ
1. **`utils/typeConverters.ts`** - ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ›é–¢æ•°
2. **`utils/workTimeConverters.ts`** - å‹¤å‹™æ™‚é–“å¤‰æ›é–¢æ•°
3. **`utils/colorUtils.ts`** - è‰²é–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

### Phase 3: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®å‹ç½®ãæ›ãˆ
1. **hooks/useWeekData.ts** - `any[]` â†’ å…·ä½“çš„ãªå‹
2. **hooks/useWorkTimes.ts** - `any` â†’ `ClientWorkTime`
3. **lib/client-db.ts** - `any[]` â†’ `ServerEvent[]`
4. **components/TimeGrid.tsx** - `any[]` â†’ `ClientEvent[]`
5. **page.tsx** - `any` â†’ å…·ä½“çš„ãªå‹

### Phase 4: å‹å®‰å…¨æ€§ã®æ¤œè¨¼
1. **TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£**
2. **å‹ãƒã‚§ãƒƒã‚¯ã®è¿½åŠ **
3. **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å‹æ¤œè¨¼ã®å®Ÿè£…**

## ğŸ“ ç§»è¡Œã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 1. æ®µéšçš„ç§»è¡Œ
- ä¸€åº¦ã«å…¨ã¦ã®å‹ã‚’å¤‰æ›´ã›ãšã€æ®µéšçš„ã«ç§»è¡Œ
- å„æ®µéšã§TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
- æ—¢å­˜ã®æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### 2. å¾Œæ–¹äº’æ›æ€§ã®ç¶­æŒ
- æ—¢å­˜ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã®äº’æ›æ€§ã‚’ä¿ã¤
- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¨ã®äº’æ›æ€§ã‚’ä¿ã¤
- æ®µéšçš„ãªå‹å¤‰æ›ã‚’å®Ÿè£…

### 3. ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
- å‹å¤‰æ›é–¢æ•°ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- å‹å®‰å…¨æ€§ã®æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
- æ—¢å­˜æ©Ÿèƒ½ã®å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ

## ğŸ¯ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. å‹å®‰å…¨æ€§ã®å‘ä¸Š
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ã‚¨ãƒ©ãƒ¼æ¤œå‡º
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã®å‰Šæ¸›
- IDEã®è‡ªå‹•è£œå®Œæ©Ÿèƒ½ã®å‘ä¸Š

### 2. ä¿å®ˆæ€§ã®å‘ä¸Š
- å‹å®šç¾©ã®ä¸€å…ƒåŒ–
- é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
- å‹ã®ä¸æ•´åˆã®è§£æ¶ˆ

### 3. é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š
- å‹æ¨è«–ã«ã‚ˆã‚‹é–‹ç™ºæ”¯æ´
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å®‰å…¨æ€§å‘ä¸Š
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ã®å‹å®šç¾©

ã“ã®å‹æ•´ç†ä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦ã€æ®µéšçš„ã«å‹å®‰å…¨æ€§ã‚’å‘ä¸Šã•ã›ã€ä¿å®ˆæ€§ã®é«˜ã„ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚ 
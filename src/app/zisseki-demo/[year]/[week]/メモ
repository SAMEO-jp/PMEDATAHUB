 🏗️ 新しい構造の説明

  レベル1: メインタブ (UIState.hierarchy.activeTab)  
  - "project" | "indirect"

  レベル2: サブタブ (UIState.hierarchy.activeSubTabs)
  - project: "計画" | "設計" | "会議" | "購入品" | "その他"
  - indirect: "純間接" | "目的間接" | "控除時間"

  レベル3: 詳細タブ (UIState.hierarchy.detailTabs)
  - detailTabs.project.計画: "計画図" | "検討書" | "見積り"
  - detailTabs.project.設計: "計画図" | "詳細図" | "組立図" | "改正図"
  - detailTabs.project.会議: "内部会議" | "外部会議" | "打ち合わせ"
  - detailTabs.project.購入品: "設備" | "材料" | "その他"
  - detailTabs.project.その他: "出張" | "研修" | "その他"
  - detailTabs.indirect.純間接: "日報入力" | "報告書作成" | "その他"
  - detailTabs.indirect.目的間接: "〇先対応" | "品質管理" | "安全管理"
  - detailTabs.indirect.控除時間: "休憩" | "私用" | "その他"

  レベル4: 業務タイプ (UIState.hierarchy.businessTypes)
  - businessTypes.planning.planningSubType: 業務の具体的な種類
  - businessTypes.design.designSubType: 設計作業の詳細
  - businessTypes.meeting.meetingType: 会議の種類
  - businessTypes.purchase.purchaseType: 購入品の種類
  - businessTypes.other.otherType: その他の種類
  - businessTypes.indirect.indirectType: 間接業務の種類

  ✅ 実装完了した改善点

  1. **階層の明確化**: 4段階がそれぞれ独立した状態として管理される
  2. **状態の分離**: UI状態とサイドバー状態が適切に分離
  3. **型安全性**: 各階層レベルで明確な型定義
  4. **保守性**: 新しい業務タイプの追加が容易
  5. **双方向連携**: イベント選択とサイドバー操作の双方向同期
  6. **統合された状態管理**: Event Reducerに全てのUI状態を統合

  🔄 実装された機能

  1. **Event Reducerの拡張**
     - 4段階階層の状態管理
     - 双方向連携の実装
     - 型安全性の確保

  2. **新しいアクション**
     - SET_ACTIVE_TAB: メインタブの変更
     - SET_ACTIVE_SUBTAB: サブタブの変更
     - SET_DETAIL_TAB: 詳細タブの変更
     - SET_BUSINESS_TYPE: 業務タイプの変更
     - SYNC_HIERARCHY_TO_EVENT: 階層状態のイベント同期

  3. **新しいハンドラー**
     - handleHierarchyChange: 階層状態の変更処理
     - syncHierarchyToSelectedEvent: 階層状態のイベント同期

  4. **セレクターの拡張**
     - getHierarchyState: 階層状態の取得
     - getDetailTab: 詳細タブの取得
     - getBusinessType: 業務タイプの取得

  この新しい構造により、「業務区分チップス（レベル4）をクリックしてもイベントが消えない」問題が解決され、すべての階層でデータの整合性が保たれます。

  🎯 期待される効果

  - **データの整合性向上**: イベントの属性とサイドバーの状態が常に同期
  - **双方向連携**: イベント選択 → サイドバー反映、サイドバー操作 → イベント更新
  - **保守性向上**: 状態管理の一元化
  - **デバッグ容易性**: 状態の追跡が簡単
  - **型安全性**: TypeScriptの恩恵を最大限活用
  - **拡張性**: 新しい業務タイプの追加が容易

  🔧 修正した不具合

  ### 不具合1: 詳細タブ（レベル3）の選択状態表示
  **問題**: タブを選択しても選択状態のコンポーネント（色変化）にならないものがある
  **修正内容**:
  - ProjectDetailTabsコンポーネントの選択状態判定ロジックを修正
  - イベントが選択されている場合は、そのイベントのsubTabTypeと比較
  - その他タブの場合は、selectedOtherSubTabと比較

  ### 不具合2: レベル4の業務コードの下2桁のみ変更と選択解除機能
  **問題**: 
  1. レベル4は業務コードの下2桁にだけ影響を与えるべきなのに、3桁目も一緒に変わる
  2. チップスをもう一度押したら選択解除状態にしたい
  **修正内容**:
  - 全てのタブコンテンツ（PlanningTabContent, DesignTabContent, MeetingTabContent, OtherTabContent）を修正
  - 現在のactivityCodeから上位2桁を取得し、下2桁のみ変更するロジックに変更
  - 選択解除機能を追加：現在選択されているチップスをクリックすると選択解除
  - 選択解除時は下2桁を00に設定

  📋 修正したファイル
  - `components/sidebar/tabs/ProjectDetailTabs.tsx`: 詳細タブの選択状態表示修正
  - `components/sidebar/tabs/PlanningTabContent.tsx`: レベル4の業務コード修正と選択解除機能追加
  - `components/sidebar/tabs/DesignTabContent.tsx`: レベル4の業務コード修正と選択解除機能追加
  - `components/sidebar/tabs/MeetingTabContent.tsx`: レベル4の業務コード修正と選択解除機能追加
  - `components/sidebar/tabs/OtherTabContent.tsx`: レベル4の業務コード修正と選択解除機能追加

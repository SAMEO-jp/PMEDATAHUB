# クリーンアーキテクチャの層構造

## 概要

このドキュメントでは、プロジェクトで採用しているクリーンアーキテクチャの層構造と各層の役割について説明します。

## 4つの主要層

### 1. ドメイン層（Domain Layer）
- **何をするか**: ビジネスの核心となるルールとロジック
- **何を決めるか**: ビジネスがどう動くべきか
- **特徴**: 最も内側、外部に依存しない

### 2. アプリケーション層（Application Layer）
- **何をするか**: 具体的な機能の実現方法
- **何を決めるか**: どの順序で何を実行するか
- **特徴**: ドメイン層を使って機能を組み立てる

### 3. プレゼンテーション層（Presentation Layer）
- **何をするか**: ユーザーとのやり取り
- **何を決めるか**: どのように表示し、操作を受け取るか
- **特徴**: ユーザーインターフェースの担当

### 4. インフラストラクチャ層（Infrastructure Layer）
- **何をするか**: 技術的な実装の詳細
- **何を決めるか**: どの技術を使って実現するか
- **特徴**: 最も外側、技術に依存する

## 依存関係の方向

```
プレゼンテーション層
    ↓
アプリケーション層
    ↓
ドメイン層
    ↓
インフラストラクチャ層
```

**重要な原則**: 内側の層は外側の層に依存してはいけない

## 各層の細分化

### 1. ドメイン層（Domain Layer）
- **エンティティ層**: ビジネスオブジェクトの定義
- **バリューオブジェクト層**: 不変な値オブジェクト
- **ドメインサービス層**: エンティティ間のビジネスロジック
- **ドメインイベント層**: ビジネスイベントの定義

### 2. アプリケーション層（Application Layer）
- **ユースケース層**: 具体的な機能の実現
- **アプリケーションサービス層**: 複雑な処理の調整
- **コマンド・クエリ層**: データ操作の指示
- **イベントハンドラー層**: ドメインイベントの処理

### 3. プレゼンテーション層（Presentation Layer）
- **UI層**: 画面表示と操作
- **コントローラー層**: ユーザー入力の処理
- **ビューモデル層**: UI用のデータ変換
- **ルーター層**: 画面遷移の制御

### 4. インフラストラクチャ層（Infrastructure Layer）
- **データ層**: データベース操作
- **外部API層**: 外部サービスとの通信
- **設定層**: アプリケーション設定
- **ログ層**: ログ出力と監視

## 現在のプロジェクトでの分類例

### プレゼンテーション層
- `<AuthProvider>` - UI状態管理と配布
- Reactコンポーネント - UI表示と操作
- UI状態管理（useState, useReducer）

### インフラストラクチャ層
- `<TRPCProvider>` - API通信の技術的実装
- データベース接続
- 外部API通信

## 各層の特徴まとめ

| 層 | 質問 | 答え | 責任 |
|----|------|------|------|
| **ドメイン層** | 「何を実現するか？」 | ビジネスの目的 | ビジネスロジック |
| **アプリケーション層** | 「どう実現するか？」 | 機能の実現方法 | ユースケース実装 |
| **プレゼンテーション層** | 「どう見せるか？」 | 表示と操作 | UI/UX |
| **インフラストラクチャ層** | 「どう技術実装するか？」 | 技術的詳細 | 技術実装 |

## 実装時の注意点

1. **責任の分離**: 各層は明確な責任を持つ
2. **依存関係の制御**: 内側の層は外側の層に依存しない
3. **変更の影響範囲**: 層を分離することで変更の影響を最小化
4. **テストの容易性**: 層ごとに独立してテスト可能

## 参考資料

- クリーンアーキテクチャ（Robert C. Martin）
- ドメイン駆動設計（Eric Evans）
- 責任分離の原則（Single Responsibility Principle）


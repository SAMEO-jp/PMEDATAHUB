---
description: 
globs: 
alwaysApply: false
---
# å«ã¶å±¤
- èª­ã¿è¾¼ã‚“ã ã‚‰ã€Œã¯!!!4. layout_header.mdc!!!ã€ã¨å«ã¶

# ãƒ˜ãƒƒãƒ€ãƒ¼è¨­è¨ˆãƒ»å®Ÿè£…ãƒ«ãƒ¼ãƒ«

## ğŸ“‹ åŸºæœ¬åŸå‰‡

### ãƒ˜ãƒƒãƒ€ãƒ¼ã®å½¹å‰²
- **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ä¸»è¦ãªãƒšãƒ¼ã‚¸ã¸ã®å°ç·šæä¾›
- **ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£è¡¨ç¤º
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±**: ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º
- **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: æ¤œç´¢ã€é€šçŸ¥ã€è¨­å®šãªã©ã®ä¸»è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- **ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ **: ç¾åœ¨ä½ç½®ã®è¡¨ç¤º

### è¨­è¨ˆæ–¹é‡
- æ©Ÿèƒ½ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’æ¡ç”¨
- çŠ¶æ…‹ç®¡ç†ã¯ Zustand ã‚’ä½¿ç”¨ã—ã€é©åˆ‡ã«åˆ†é›¢
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’æœ€å„ªå…ˆ
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…

## ğŸ—ï¸ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### æ¨å¥¨æ§‹é€ 
```
src/features/header/
â”œâ”€â”€ components/                    # ãƒ˜ãƒƒãƒ€ãƒ¼é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ HeaderTitle.tsx           # ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒ­ã‚´
â”‚   â”œâ”€â”€ HeaderNavigation.tsx      # ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ HeaderBreadcrumbs.tsx     # ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ 
â”‚   â”œâ”€â”€ HeaderUserMenu.tsx        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”‚   â”œâ”€â”€ HeaderActions.tsx         # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤
â”‚   â”œâ”€â”€ HeaderMobileMenu.tsx      # ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”‚   â””â”€â”€ HeaderSearch.tsx          # æ¤œç´¢æ©Ÿèƒ½
â”œâ”€â”€ hooks/                        # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useHeaderState.ts         # ãƒ˜ãƒƒãƒ€ãƒ¼çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ useHeaderActions.ts       # ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ useBreadcrumbs.ts         # ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ ç®¡ç†
â”‚   â””â”€â”€ useNavigation.ts          # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
â”œâ”€â”€ store/                        # æ©Ÿèƒ½å†…ã®Zustandã‚¹ãƒ©ã‚¤ã‚¹
â”‚   â”œâ”€â”€ headerSlice.ts            # ãƒ˜ãƒƒãƒ€ãƒ¼çŠ¶æ…‹ã‚¹ãƒ©ã‚¤ã‚¹
â”‚   â””â”€â”€ header.types.ts           # ãƒ˜ãƒƒãƒ€ãƒ¼å‹å®šç¾©
â”œâ”€â”€ utils/                        # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ breadcrumbUtils.ts        # ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ ç”Ÿæˆ
â”‚   â”œâ”€â”€ navigationUtils.ts        # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
â”‚   â””â”€â”€ headerUtils.ts            # ãƒ˜ãƒƒãƒ€ãƒ¼å…±é€šå‡¦ç†
â”œâ”€â”€ constants/                    # å®šæ•°å®šç¾©
â”‚   â”œâ”€â”€ navigationConstants.ts    # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®šæ•°
â”‚   â”œâ”€â”€ headerConstants.ts        # ãƒ˜ãƒƒãƒ€ãƒ¼å®šæ•°
â”‚   â””â”€â”€ routes.ts                 # ãƒ«ãƒ¼ãƒˆå®šç¾©
â”œâ”€â”€ CommonHeader.tsx              # ãƒ¡ã‚¤ãƒ³ã®Headerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ index.ts                      # å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹ã‚‚ã®ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

## âœ… å®Ÿè£…ãƒ«ãƒ¼ãƒ«

### ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`CommonHeader.tsx`)
```tsx
// src/features/header/CommonHeader.tsx
'use client'

import { HeaderTitle } from './components/HeaderTitle'
import { HeaderNavigation } from './components/HeaderNavigation'
import { HeaderBreadcrumbs } from './components/HeaderBreadcrumbs'
import { HeaderUserMenu } from './components/HeaderUserMenu'
import { HeaderActions } from './components/HeaderActions'
import { HeaderMobileMenu } from './components/HeaderMobileMenu'
import { useHeaderState } from './hooks/useHeaderState'

export const CommonHeader = () => {
  const { isMobileMenuOpen, toggleMobileMenu } = useHeaderState()

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 items-center">
        {/* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */}
        <div className="hidden md:flex md:flex-1 md:items-center md:justify-between">
          <div className="flex items-center space-x-4">
            <HeaderTitle />
            <HeaderNavigation />
          </div>
          <div className="flex items-center space-x-4">
            <HeaderActions />
            <HeaderUserMenu />
          </div>
        </div>
      </div>
      
      {/* ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ  */}
      <HeaderBreadcrumbs />
    </header>
  )
}
```

### çŠ¶æ…‹ç®¡ç† (`headerSlice.ts`)
```tsx
// src/features/header/store/headerSlice.ts
import { create } from 'zustand'
import { HeaderState, HeaderActions } from './header.types'

export const useHeaderStore = create<HeaderState & HeaderActions>((set) => ({
  // çŠ¶æ…‹
  isMobileMenuOpen: false,
  currentPath: '/',
  breadcrumbs: [],
  notifications: [],
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  toggleMobileMenu: () => set((state) => ({ 
    isMobileMenuOpen: !state.isMobileMenuOpen 
  })),
  setCurrentPath: (path: string) => set({ currentPath: path }),
  setBreadcrumbs: (breadcrumbs: Breadcrumb[]) => set({ breadcrumbs }),
  addNotification: (notification: Notification) => set((state) => ({
    notifications: [...state.notifications, notification]
  })),
  clearNotifications: () => set({ notifications: [] }),
}))
```

### å‹å®šç¾© (`header.types.ts`)
```tsx
// src/features/header/store/header.types.ts
export interface Breadcrumb {
  label: string
  href: string
  isActive?: boolean
}

export interface Notification {
  id: string
  type: 'info' | 'success' | 'warning' | 'error'
  message: string
  timestamp: Date
}

export interface HeaderState {
  isMobileMenuOpen: boolean
  currentPath: string
  breadcrumbs: Breadcrumb[]
  notifications: Notification[]
}

export interface HeaderActions {
  toggleMobileMenu: () => void
  setCurrentPath: (path: string) => void
  setBreadcrumbs: (breadcrumbs: Breadcrumb[]) => void
  addNotification: (notification: Notification) => void
  clearNotifications: () => void
}
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ (`useHeaderState.ts`)
```tsx
// src/features/header/hooks/useHeaderState.ts
import { useHeaderStore } from '../store/headerSlice'
import { usePathname } from 'next/navigation'
import { useEffect } from 'react'
import { generateBreadcrumbs } from '../utils/breadcrumbUtils'

export const useHeaderState = () => {
  const pathname = usePathname()
  const {
    isMobileMenuOpen,
    currentPath,
    breadcrumbs,
    toggleMobileMenu,
    setCurrentPath,
    setBreadcrumbs,
  } = useHeaderStore()

  // ãƒ‘ã‚¹å¤‰æ›´æ™‚ã®å‡¦ç†
  useEffect(() => {
    if (pathname !== currentPath) {
      setCurrentPath(pathname)
      const newBreadcrumbs = generateBreadcrumbs(pathname)
      setBreadcrumbs(newBreadcrumbs)
    }
  }, [pathname, currentPath, setCurrentPath, setBreadcrumbs])

  return {
    isMobileMenuOpen,
    breadcrumbs,
    toggleMobileMenu,
  }
}
```

### ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`breadcrumbUtils.ts`)
```tsx
// src/features/header/utils/breadcrumbUtils.ts
import { Breadcrumb } from '../store/header.types'

export const generateBreadcrumbs = (pathname: string): Breadcrumb[] => {
  const segments = pathname.split('/').filter(Boolean)
  const breadcrumbs: Breadcrumb[] = [
    { label: 'ãƒ›ãƒ¼ãƒ ', href: '/', isActive: pathname === '/' }
  ]

  let currentPath = ''
  segments.forEach((segment, index) => {
    currentPath += `/${segment}`
    const isLast = index === segments.length - 1
    
    breadcrumbs.push({
      label: formatSegmentLabel(segment),
      href: currentPath,
      isActive: isLast
    })
  })

  return breadcrumbs
}

const formatSegmentLabel = (segment: string): string => {
  // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿ã‚„ã™ã„ãƒ©ãƒ™ãƒ«ã«å¤‰æ›
  const labelMap: Record<string, string> = {
    'dashboard': 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
    'projects': 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
    'settings': 'è¨­å®š',
    // å¿…è¦ã«å¿œã˜ã¦è¿½åŠ 
  }
  
  return labelMap[segment] || segment.charAt(0).toUpperCase() + segment.slice(1)
}
```

## ğŸ¨ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ: `sm:`, `md:`, `lg:`, `xl:`
- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ `md:hidden`
- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `hidden md:flex`

### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
```tsx
// ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ãŸãƒœã‚¿ãƒ³å®Ÿè£…ä¾‹
<button
  aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"
  aria-expanded={isMobileMenuOpen}
  aria-controls="mobile-menu"
  onClick={toggleMobileMenu}
  className="p-2 rounded-md hover:bg-accent"
>
  <Menu className="h-5 w-5" />
</button>
```

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
```tsx
// Framer Motion ã‚’ä½¿ç”¨ã—ãŸã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
import { motion, AnimatePresence } from 'framer-motion'

<AnimatePresence>
  {isMobileMenuOpen && (
    <motion.div
      initial={{ opacity: 0, y: -20 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -20 }}
      transition={{ duration: 0.2 }}
      className="absolute top-full left-0 w-full bg-background border-b"
    >
      {/* ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†…å®¹ */}
    </motion.div>
  )}
</AnimatePresence>
```

## ğŸ”§ çµ±åˆãƒ«ãƒ¼ãƒ«

### Root Layout ã¨ã®çµ±åˆ
```tsx
// src/app/layout.tsx
import { CommonHeader } from '@/features/header'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ja">
      <body>
        <CommonHeader />
        <main className="min-h-screen pt-14">
          {children}
        </main>
      </body>
    </html>
  )
}
```

### èªè¨¼çŠ¶æ…‹ã¨ã®é€£æº
```tsx
// src/features/header/components/HeaderUserMenu.tsx
import { useAuthStore } from '@/store/slices/authSlice'

export const HeaderUserMenu = () => {
  const { user, isAuthenticated, logout } = useAuthStore()

  if (!isAuthenticated) {
    return (
      <div className="flex items-center space-x-2">
        <Button variant="ghost" asChild>
          <Link href="/login">ãƒ­ã‚°ã‚¤ãƒ³</Link>
        </Button>
        <Button asChild>
          <Link href="/register">æ–°è¦ç™»éŒ²</Link>
        </Button>
      </div>
    )
  }

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" className="relative h-8 w-8 rounded-full">
          <Avatar className="h-8 w-8">
            <AvatarImage src={user?.avatar} alt={user?.name} />
            <AvatarFallback>{user?.name?.charAt(0)}</AvatarFallback>
          </Avatar>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="w-56" align="end" forceMount>
        <DropdownMenuLabel className="font-normal">
          <div className="flex flex-col space-y-1">
            <p className="text-sm font-medium leading-none">{user?.name}</p>
            <p className="text-xs leading-none text-muted-foreground">
              {user?.email}
            </p>
          </div>
        </DropdownMenuLabel>
        <DropdownMenuSeparator />
        <DropdownMenuItem asChild>
          <Link href="/profile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</Link>
        </DropdownMenuItem>
        <DropdownMenuItem asChild>
          <Link href="/settings">è¨­å®š</Link>
        </DropdownMenuItem>
        <DropdownMenuSeparator />
        <DropdownMenuItem onClick={logout}>
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  )
}
```

## ğŸš¨ é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³

- âŒ **ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…**
- âŒ **ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã®ç›´æ¥æ“ä½œ**
- âŒ **ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**
- âŒ **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®ä¸å‚™**
- âŒ **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®ç„¡è¦–**
- âŒ **éåº¦ã«è¤‡é›‘ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
- âŒ **å‹å®‰å…¨æ€§ã‚’ç„¡è¦–ã—ãŸå®Ÿè£…**

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] æ©Ÿèƒ½ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«å¾“ã£ã¦ã„ã‚‹ã‹
- [ ] é©åˆ‡ãªçŠ¶æ…‹ç®¡ç†ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãŒè€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] å‹å®‰å…¨æ€§ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé©åˆ‡ã«å‹•ä½œã™ã‚‹ã‹
- [ ] èªè¨¼çŠ¶æ…‹ã¨ã®é€£æºãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¹ãƒ ãƒ¼ã‚ºã«å‹•ä½œã™ã‚‹ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹

## ğŸ”— é–¢é€£ãƒ«ãƒ¼ãƒ«

- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…¨ä½“ã®å®Ÿè£…ã¯ `.cursor\rules\4. layout` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
  @file 4. layout

- API å‘¼ã³å‡ºã—ã¯ `.cursor\rules\2.api-patterns.mdc` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
  @file 2.api-patterns.mdc

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ã¯ `.cursor\rules\1.0.tsx.mdc` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
  @file 1.0.tsx.mdc



---
description: .tsx,.tsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ«ãƒ¼ãƒ«
globs: 
alwaysApply: false
---
---
description: ".tsx,.tsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ«ãƒ¼ãƒ«"
globs:
  - "src/**/*.tsx"
  - "src/**/*.ts"
alwaysApply: false
ruleType: Agent Requested
tags:
  - .tsx
  - .ts
priority: 2
version: "1.1.0"
---

# å«ã¶å±¤
- èª­ã¿è¾¼ã‚“ã ã‚‰ã€Œ!!!1.2.tsx codeselection.mdc!!!ã€ã¨å«ã¶

# ğŸ“‹ .tsx ãƒ•ã‚¡ã‚¤ãƒ«åŸºæœ¬æ§‹é€ 

## 2. ğŸ”– .tsx ãƒ•ã‚¡ã‚¤ãƒ«åŸºæœ¬æ§‹é€ 

### 2-1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŸºæœ¬æ§‹é€ 

### ã‚¤ãƒ³ãƒãƒ¼ãƒˆå±¤ã®è©³ç´°
```tsx
// ==========================================
// ã‚¤ãƒ³ãƒãƒ¼ãƒˆå±¤
// ==========================================
//Reacté–¢é€£ï¼ˆå¿…ãšæœ€åˆï¼‰
import { 
  useState, 
  useEffect, 
  useCallback, 
  useMemo,
  useRef,
  forwardRef 
} from 'react';

//Next.jsé–¢é€£
import { useRouter, useSearchParams, usePathname } from 'next/navigation';
import { notFound, redirect } from 'next/navigation';
import Image from 'next/image';
import Link from 'next/link';

//å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼‰
import { clsx } from 'clsx';
import { format } from 'date-fns';
import { toast } from 'react-hot-toast';
import { z } from 'zod';

//æ±ç”¨å†…éƒ¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ç”¨ï¼‰
import { Button } from '@ui/button';
import { Input } from '@ui/input';
import { ProjectCard } from '@src/components/project/ProjectCard';
import { Modal } from '@src/components/ui/Modal';

//ãƒšãƒ¼ã‚¸å›ºæœ‰å†…éƒ¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãã®ãƒšãƒ¼ã‚¸å°‚ç”¨ï¼‰
import { PageHeader } from './components/PageHeader';
import { DataTable } from './components/DataTable';

//æ±ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ç”¨ï¼‰
import { useDebounce } from '@src/hooks/useDebounce';
import { useLocalStorage } from '@src/hooks/useLocalStorage';
import { useAuth } from '@src/hooks/useAuth';
import { useFetchData } from '@src/hooks/useFetchData';

//ãƒšãƒ¼ã‚¸å›ºæœ‰ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆãã®ãƒšãƒ¼ã‚¸å°‚ç”¨ï¼‰
import { usePageShortcuts } from './hooks/usePageShortcuts';
import { usePageState } from './hooks/usePageState';

//æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ç”¨ï¼‰
import { cn } from '@src/lib/utils';
import { formatCurrency } from '@src/lib/format';
import { validateForm } from '@src/lib/validation';

//ãƒšãƒ¼ã‚¸å›ºæœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆãã®ãƒšãƒ¼ã‚¸å°‚ç”¨ï¼‰
import { formatPageData } from './utils/formatPageData';
import { validatePageInput } from './utils/validation';

//æ±ç”¨å‹å®šç¾©ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ç”¨ï¼‰
import type { User, Project, ApiResponse } from '@src/types';
import type { DatabaseConfig, AppConfig } from '@src/types/config';

//ãƒšãƒ¼ã‚¸å›ºæœ‰å‹å®šç¾©ï¼ˆãã®ãƒšãƒ¼ã‚¸å°‚ç”¨ï¼‰
import type { PageProps, PageState } from './types';
import type { FormData, ValidationResult } from './types/forms';

```
#### æ³¨æ„ç‚¹:
 - æœªä½¿ç”¨ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯å‰Šé™¤
 - æœªä½¿ç”¨ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯å¿…ãšå‰Šé™¤
 - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨åå‰ä»˜ãã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’åˆ†ã‘ã‚‹
 - ç›¸å¯¾ãƒ‘ã‚¹ã‚ˆã‚Šçµ¶å¯¾ãƒ‘ã‚¹ï¼ˆ@src/ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰ã‚’å„ªå…ˆ
 - tsconfig.jsonã‚’è¦‹ã¦ã€@/ã®å…¥ã‚Œæ–¹ã‚’å­¦ã¶ã€‚

#### å‘½åè¦å‰‡:
 - ãƒ•ã‚¡ã‚¤ãƒ«å: PascalCaseï¼ˆUserProfile.tsx, DataTable.tsxï¼‰
 - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå: PascalCaseï¼ˆUserProfile, DataTableï¼‰
 - ãƒ•ãƒƒã‚¯å: useãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆuseUserData, useProjectActionsï¼‰
 - å‹å: PascalCaseï¼ˆUserData, ProjectConfigï¼‰
 - æ©Ÿèƒ½ã‚’è¡¨ã™åå‰ã‚’ä½¿ç”¨ï¼ˆUserList, ProjectCardï¼‰
 - æ¥å°¾è¾ã®çµ±ä¸€ï¼ˆTable, Form, Card, Modalï¼‰



### 2-2. å‹å®šç¾©å±¤ã®è©³ç´°
```tsx
// ==========================================
// å‹å®šç¾©å±¤ï¼ˆProps, å†…éƒ¨å‹, APIå‹ï¼‰
// ==========================================
// 1. ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Props
interface PageProps {
  params: { 
    project_id: string;
    [key: string]: string;
  };
  searchParams: { 
    page?: string;
    filter?: string;
    sort?: 'asc' | 'desc';
    [key: string]: string | string[] | undefined;
  };
}

// 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Props
interface ProjectFormProps {
  initialData?: Partial<ProjectFormData>;
  onSubmit: (data: ProjectFormData) => Promise<void>;
  onCancel?: () => void;
  isLoading?: boolean;
  errors?: Record<string, string>;
}

// 3. ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å‹
interface ProjectFormData {
  name: string;
  description: string;
  status: ProjectStatus;
  tags: string[];
  dueDate: Date | null;
  budget?: number;
}

// 4. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å‹
interface Project {
  id: string;
  name: string;
  description: string;
  status: ProjectStatus;
  createdAt: Date;
  updatedAt: Date;
  owner: Pick<User, 'id' | 'name' | 'email'>;
}

// 5. APIé–¢é€£å‹
interface ProjectApiResponse extends ApiResponse<Project> {
  meta: {
    total: number;
    page: number;
    limit: number;
  };
}

// 6. å†…éƒ¨çŠ¶æ…‹å‹
interface ProjectPageState {
  projects: Project[];
  selectedProject: Project | null;
  isLoading: boolean;
  error: string | null;
  pagination: {
    page: number;
    total: number;
    hasMore: boolean;
  };
}

// 7. ãƒ¦ãƒ‹ã‚ªãƒ³å‹ãƒ»åˆ—æŒ™å‹
type ProjectStatus = 'draft' | 'active' | 'completed' | 'archived';
type SortOrder = 'asc' | 'desc';
type ViewMode = 'grid' | 'list' | 'table';
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- interfaceã¨typeã®ä½¿ã„åˆ†ã‘ï¼ˆæ‹¡å¼µå¯èƒ½æ€§ã‚’è€ƒæ…®ï¼‰
- Pickã€Omitã€Partialã‚’æ´»ç”¨
- ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯?ã§æ˜ç¤º
- ãƒã‚¹ãƒˆãŒæ·±ã„å ´åˆã¯åˆ¥ã®å‹ã«åˆ†é›¢

### 2-3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¤ã®è©³ç´°
```tsx
// ==========================================
// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¤
// ==========================================
export default function ProjectPage({ params, searchParams }: PageProps) {
  const router = useRouter();
  const pathname = usePathname();
  const searchParamsHook = useSearchParams();

  // 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æŠ½å‡ºã¨æ¤œè¨¼
  const projectId = params.project_id;
  
  // 2. ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹å®‰å…¨ãªå–å¾—
  const currentPage = searchParams.page ? 
    Math.max(1, parseInt(searchParams.page, 10)) : 1;
  
  const filterStatus = (searchParams.filter as ProjectStatus) || 'active';
  const sortOrder = (searchParams.sort as SortOrder) || 'asc';
  const viewMode = (searchParams.view as ViewMode) || 'grid';
  
  // 3. æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å‡¦ç†
  const searchQuery = Array.isArray(searchParams.q) ? 
    searchParams.q[0] : searchParams.q || '';

  // 4. URLæ›´æ–°ç”¨ã®é–¢æ•°
  const updateSearchParams = useCallback((updates: Record<string, string | null>) => {
    const current = new URLSearchParams(searchParamsHook);
    
    Object.entries(updates).forEach(([key, value]) => {
      if (value === null) {
        current.delete(key);
      } else {
        current.set(key, value);
      }
    });

    const search = current.toString();
    const query = search ? `?${search}` : '';
    router.push(`${pathname}${query}`);
  }, [router, pathname, searchParamsHook]);

  // 5. æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ï¼ˆç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
  if (!projectId || !/^[a-zA-Z0-9-_]+$/.test(projectId)) {
    notFound();
  }
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹å¤‰æ›ã¯å¿…ãšå®‰å…¨ã«è¡Œã†
- ç„¡åŠ¹ãªå€¤ã«å¯¾ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
- URLæ›´æ–°æ™‚ã®æ—¢å­˜ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿æŒ
- æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã§ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’å‡¦ç†

### 2-4. çŠ¶æ…‹ç®¡ç†å±¤ã®è©³ç´°
```tsx
// ==========================================
// çŠ¶æ…‹ç®¡ç†å±¤
// ==========================================
// 1. åŸºæœ¬çš„ãªçŠ¶æ…‹
const [projects, setProjects] = useState<Project[]>([]);
const [selectedProject, setSelectedProject] = useState<Project | null>(null);

// 2. UIçŠ¶æ…‹
const [isLoading, setIsLoading] = useState(false);
const [isSubmitting, setIsSubmitting] = useState(false);
const [error, setError] = useState<string | null>(null);

// 3. ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹
const [formData, setFormData] = useState<ProjectFormData>({
  name: '',
  description: '',
  status: 'draft',
  tags: [],
  dueDate: null,
  budget: undefined
});

const [formErrors, setFormErrors] = useState<Record<string, string>>({});

// 4. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚½ãƒ¼ãƒˆçŠ¶æ…‹
const [filters, setFilters] = useState({
  status: filterStatus,
  search: searchQuery,
  tags: [] as string[]
});

const [sorting, setSorting] = useState({
  field: 'createdAt' as keyof Project,
  order: sortOrder
});

// 5. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
const [pagination, setPagination] = useState({
  page: currentPage,
  limit: 20,
  total: 0,
  hasMore: false
});

// 6. è¤‡é›‘ãªçŠ¶æ…‹ã®å ´åˆã¯useReducerã‚’ä½¿ç”¨
interface AppState {
  projects: Project[];
  filters: FilterState;
  ui: UIState;
}

const initialState: AppState = {
  projects: [],
  filters: { status: 'all', search: '', tags: [] },
  ui: { isLoading: false, error: null }
};

const [state, dispatch] = useReducer(appReducer, initialState);

// 7. refçŠ¶æ…‹ï¼ˆDOMæ“ä½œç”¨ï¼‰
const searchInputRef = useRef<HTMLInputElement>(null);
const containerRef = useRef<HTMLDivElement>(null);
```

**çŠ¶æ…‹ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- é–¢é€£ã™ã‚‹çŠ¶æ…‹ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã‚ã‚‹
- çŠ¶æ…‹æ›´æ–°ã¯é–¢æ•°å½¢å¼ `setState(prev => ({ ...prev, newValue }))`
- è¤‡é›‘ãªçŠ¶æ…‹ãƒ­ã‚¸ãƒƒã‚¯ã¯useReducerã‚’æ¤œè¨
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé‡è¦ãªå ´åˆã¯çŠ¶æ…‹ã®åˆ†é›¢ã‚’æ¤œè¨

### 2-5. ãƒ‡ãƒ¼ã‚¿å–å¾—å±¤ã®è©³ç´°
```tsx
// ==========================================
// ãƒ‡ãƒ¼ã‚¿å–å¾—å±¤
// ==========================================
// 1. Server Componentã®å ´åˆ
export default async function ProjectPage({ params }: PageProps) {
  try {
    // ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—
    const [project, relatedProjects, activities] = await Promise.all([
      fetchProject(params.project_id),
      fetchRelatedProjects(params.project_id),
      fetchProjectActivities(params.project_id)
    ]);

    // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
    if (!project) {
      notFound();
    }

    return <ProjectDetails project={project} />;
  } catch (error) {
    console.error('Failed to fetch project:', error);
    throw error; // Error Boundaryã§ã‚­ãƒ£ãƒƒãƒ
  }
}

// 2. Client Componentã®å ´åˆ
useEffect(() => {
  let isCancelled = false;
  
  const fetchProjects = async () => {
    if (!projectId) return;
    
    setIsLoading(true);
    setError(null);
    
    try {
      const response = await fetch(`/api/projects/${projectId}`, {
        signal: abortController.signal // ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯¾å¿œ
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      
      // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿æ›´æ–°
      if (!isCancelled) {
        setProjects(data.projects);
        setPagination(prev => ({
          ...prev,
          total: data.meta.total,
          hasMore: data.meta.hasMore
        }));
      }
    } catch (error) {
      if (!isCancelled && error.name !== 'AbortError') {
        setError(error instanceof Error ? error.message : 'Unknown error');
        console.error('Fetch error:', error);
      }
    } finally {
      if (!isCancelled) {
        setIsLoading(false);
      }
    }
  };

  const abortController = new AbortController();
  fetchProjects();

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  return () => {
    isCancelled = true;
    abortController.abort();
  };
}, [projectId, currentPage, filters.status]);

// 3. ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
const { data: projects, loading, error, refetch } = useProjects({
  projectId,
  filters,
  pagination: { page: currentPage, limit: 20 }
});
```

**ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- AbortControllerã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯¾å¿œ
- ç«¶åˆçŠ¶æ…‹ï¼ˆrace conditionï¼‰ã®é˜²æ­¢
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¾¹åº•
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®é©åˆ‡ãªç®¡ç†
- å†å–å¾—æ©Ÿèƒ½ã®æä¾›

### 2-6. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ã®è©³ç´°
```tsx
// ==========================================
// ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
// ==========================================
// 1. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
const filteredProjects = useMemo(() => {
  return projects.filter(project => {
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿
    if (filters.status !== 'all' && project.status !== filters.status) {
      return false;
    }
    
    // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿
    if (filters.search) {
      const searchLower = filters.search.toLowerCase();
      return (
        project.name.toLowerCase().includes(searchLower) ||
        project.description.toLowerCase().includes(searchLower) ||
        project.tags.some(tag => tag.toLowerCase().includes(searchLower))
      );
    }
    
    // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿
    if (filters.tags.length > 0) {
      return filters.tags.every(tag => project.tags.includes(tag));
    }
    
    return true;
  });
}, [projects, filters]);

// 2. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ãƒˆ
const sortedProjects = useMemo(() => {
  return [...filteredProjects].sort((a, b) => {
    const aValue = a[sorting.field];
    const bValue = b[sorting.field];
    
    // æ—¥ä»˜ã®æ¯”è¼ƒ
    if (aValue instanceof Date && bValue instanceof Date) {
      return sorting.order === 'asc' 
        ? aValue.getTime() - bValue.getTime()
        : bValue.getTime() - aValue.getTime();
    }
    
    // æ–‡å­—åˆ—ã®æ¯”è¼ƒ
    if (typeof aValue === 'string' && typeof bValue === 'string') {
      return sorting.order === 'asc'
        ? aValue.localeCompare(bValue, 'ja-JP')
        : bValue.localeCompare(aValue, 'ja-JP');
    }
    
    // æ•°å€¤ã®æ¯”è¼ƒ
    if (typeof aValue === 'number' && typeof bValue === 'number') {
      return sorting.order === 'asc' ? aValue - bValue : bValue - aValue;
    }
    
    return 0;
  });
}, [filteredProjects, sorting]);

// 3. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç®—
const paginatedProjects = useMemo(() => {
  const startIndex = (pagination.page - 1) * pagination.limit;
  return sortedProjects.slice(startIndex, startIndex + pagination.limit);
}, [sortedProjects, pagination.page, pagination.limit]);

// 4. çµ±è¨ˆè¨ˆç®—
const projectStats = useMemo(() => {
  const total = projects.length;
  const completed = projects.filter(p => p.status === 'completed').length;
  const active = projects.filter(p => p.status === 'active').length;
  const overdue = projects.filter(p => 
    p.dueDate && new Date(p.dueDate) < new Date() && p.status !== 'completed'
  ).length;
  
  return {
    total,
    completed,
    active,
    overdue,
    completionRate: total > 0 ? (completed / total) * 100 : 0
  };
}, [projects]);

// 5. è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•°
const calculateProjectHealth = useCallback((project: Project) => {
  const now = new Date();
  const dueDate = project.dueDate ? new Date(project.dueDate) : null;
  
  if (!dueDate) return 'unknown';
  
  const daysRemaining = Math.ceil((dueDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
  
  if (project.status === 'completed') return 'completed';
  if (daysRemaining < 0) return 'overdue';
  if (daysRemaining <= 3) return 'critical';
  if (daysRemaining <= 7) return 'warning';
  
  return 'healthy';
}, []);
```

### 2-7. æ¤œè¨¼ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®è©³ç´°
```tsx
// ==========================================
// æ¤œè¨¼ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å±¤
// ==========================================
// 1. Zodã‚¹ã‚­ãƒ¼ãƒå®šç¾©
const projectFormSchema = z.object({
  name: z.string()
    .min(1, 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯å¿…é ˆã§ã™')
    .max(100, 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  description: z.string()
    .max(500, 'èª¬æ˜ã¯500æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„')
    .optional(),
  status: z.enum(['draft', 'active', 'completed', 'archived']),
  tags: z.array(z.string()).max(10, 'ã‚¿ã‚°ã¯10å€‹ã¾ã§è¨­å®šã§ãã¾ã™'),
  dueDate: z.date().nullable(),
  budget: z.number().positive('äºˆç®—ã¯æ­£ã®æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„').optional()
});

// 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
const validateProjectForm = useCallback((data: ProjectFormData) => {
  try {
    projectFormSchema.parse(data);
    setFormErrors({});
    return true;
  } catch (error) {
    if (error instanceof z.ZodError) {
      const errors: Record<string, string> = {};
      error.errors.forEach(err => {
        if (err.path) {
          errors[err.path.join('.')] = err.message;
        }
      });
      setFormErrors(errors);
    }
    return false;
  }
}, []);

// 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const validateField = useCallback((field: keyof ProjectFormData, value: any) => {
  try {
    projectFormSchema.shape[field].parse(value);
    setFormErrors(prev => {
      const { [field]: removed, ...rest } = prev;
      return rest;
    });
  } catch (error) {
    if (error instanceof z.ZodError) {
      setFormErrors(prev => ({
        ...prev,
        [field]: error.errors[0]?.message || 'Invalid value'
      }));
    }
  }
}, []);

// 4. ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const validateProjectNameUnique = useCallback(async (name: string, excludeId?: string) => {
  if (!name.trim()) return true;
  
  try {
    const response = await fetch(`/api/projects/validate-name`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, excludeId })
    });
    
    const result = await response.json();
    return result.isUnique;
  } catch (error) {
    console.error('Name validation failed:', error);
    return true; // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ã¯é€šã™
  }
}, []);

// 5. å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
const sanitizeInput = useCallback((input: string) => {
  return input
    .trim()
    .replace(/[<>]/g, '') // XSSå¯¾ç­–
    .replace(/\s+/g, ' '); // é€£ç¶šç©ºç™½ã®æ­£è¦åŒ–
}, []);
```

### 2-8. å¤‰æ›ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå±¤ã®è©³ç´°
```tsx
// ==========================================
// å¤‰æ›ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå±¤
// ==========================================
// 1. æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const formatDate = useCallback((date: Date | string | null) => {
  if (!date) return '-';
  
  const dateObj = typeof date === 'string' ? new Date(date) : date;
  
  if (isNaN(dateObj.getTime())) return '-';
  
  return format(dateObj, 'yyyyå¹´MMæœˆddæ—¥', { locale: ja });
}, []);

const formatRelativeDate = useCallback((date: Date | string) => {
  const dateObj = typeof date === 'string' ? new Date(date) : date;
  const now = new Date();
  const diffInDays = Math.ceil((dateObj.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
  
  if (diffInDays === 0) return 'ä»Šæ—¥';
  if (diffInDays === 1) return 'æ˜æ—¥';
  if (diffInDays === -1) return 'æ˜¨æ—¥';
  if (diffInDays > 0) return `${diffInDays}æ—¥å¾Œ`;
  return `${Math.abs(diffInDays)}æ—¥å‰`;
}, []);

// 2. æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const formatCurrency = useCallback((amount: number | null | undefined) => {
  if (amount == null) return '-';
  
  return new Intl.NumberFormat('ja-JP', {
    style: 'currency',
    currency: 'JPY',
    maximumFractionDigits: 0
  }).format(amount);
}, []);

const formatPercentage = useCallback((value: number, decimals: number = 1) => {
  return `${value.toFixed(decimals)}%`;
}, []);

// 3. ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›
const truncateText = useCallback((text: string, maxLength: number) => {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength) + '...';
}, []);

const highlightSearchTerm = useCallback((text: string, searchTerm: string) => {
  if (!searchTerm) return text;
  
  const regex = new RegExp(`(${searchTerm})`, 'gi');
  return text.replace(regex, '<mark>$1</mark>');
}, []);

// 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›
const getStatusLabel = useCallback((status: ProjectStatus) => {
  const statusLabels: Record<ProjectStatus, string> = {
    draft: 'ä¸‹æ›¸ã',
    active: 'é€²è¡Œä¸­',
    completed: 'å®Œäº†',
    archived: 'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–'
  };
  return statusLabels[status] || status;
}, []);

const getStatusColor = useCallback((status: ProjectStatus) => {
  const statusColors: Record<ProjectStatus, string> = {
    draft: 'text-gray-600 bg-gray-100',
    active: 'text-blue-600 bg-blue-100',
    completed: 'text-green-600 bg-green-100',
    archived: 'text-purple-600 bg-purple-100'
  };
  return statusColors[status] || 'text-gray-600 bg-gray-100';
}, []);

// 5. ãƒ‡ãƒ¼ã‚¿æ§‹é€ å¤‰æ›
const transformProjectsForTable = useMemo(() => {
  return sortedProjects.map(project => ({
    id: project.id,
    name: project.name,
    status: getStatusLabel(project.status),
    statusColor: getStatusColor(project.status),
    dueDate: formatDate(project.dueDate),
    relativeDueDate: project.dueDate ? formatRelativeDate(project.dueDate) : null,
    budget: formatCurrency(project.budget),
    health: calculateProjectHealth(project),
    owner: project.owner.name
  }));
}, [sortedProjects, getStatusLabel, getStatusColor, formatDate, formatRelativeDate, formatCurrency, calculateProjectHealth]);
```

### 2-9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å±¤ã®è©³ç´°
```tsx
// ==========================================
// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å±¤ï¼ˆã‚¨ãƒ©ãƒ¼å‡¦ç†ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
// ==========================================
// 1. ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®è¡¨ç¤º
if (error) {
  return (
    <div className="error-container">
      <p>Error: {error}</p>
      <Button onClick={() => window.location.reload()}>
        Retry
      </Button>
    </div>
  );
}

// 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°é–¢æ•°
const handleError = (error: unknown) => {
  console.error('Operation failed:', error);
  toast.error('æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ');
};

// 3. éåŒæœŸå‡¦ç†ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
const handleAsyncOperation = async () => {
  try {
    setIsLoading(true);
    setError(null);
    
    const result = await someAsyncOperation();
    setData(result);
  } catch (error) {
    setError(error instanceof Error ? error.message : 'Unknown error');
    handleError(error);
  } finally {
    setIsLoading(false);
  }
};
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã®æä¾›
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’è€ƒæ…®

### 2-10. å‰¯ä½œç”¨å±¤ã®è©³ç´°
```tsx
// ==========================================
// å‰¯ä½œç”¨å±¤ï¼ˆuseMemo, useCallbackï¼‰
// ==========================================
// 1. ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿
const memoizedData = useMemo(() => {
  return data.filter(item => item.status === 'active');
}, [data]);

// 2. ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸé–¢æ•°
const handleSubmit = useCallback(async (formData: FormData) => {
  try {
    await api.post('/projects', formData);
    toast.success('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ');
    router.push('/projects');
  } catch (error) {
    handleError(error);
  }
}, [router]);

// 3. è¤‡é›‘ãªè¨ˆç®—ã®ãƒ¡ãƒ¢åŒ–
const expensiveCalculation = useMemo(() => {
  return data.reduce((acc, item) => {
    // é‡ã„è¨ˆç®—å‡¦ç†
    return acc + item.value;
  }, 0);
}, [data]);
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- ä¸è¦ãªå†è¨ˆç®—ã‚’é¿ã‘ã‚‹
- ä¾å­˜é…åˆ—ã®é©åˆ‡ãªè¨­å®š
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šå¾Œã®æœ€é©åŒ–

### 2-11. ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å±¤ã®è©³ç´°
```tsx
// ==========================================
// ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å±¤ï¼ˆonClick, onSubmit, onChangeï¼‰
// ==========================================
// 1. å…¥åŠ›å€¤å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©
const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  const { name, value } = e.target;
  setFormData(prev => ({ ...prev, [name]: value }));
};

// 2. ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãƒãƒ³ãƒ‰ãƒ©
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  if (!isFormValid) return;
  
  setLoading(true);
  try {
    await submitForm(formData);
  } catch (error) {
    handleError(error);
  } finally {
    setLoading(false);
  }
};

// 3. ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
const handleItemClick = useCallback((item: Project) => {
  setSelectedProject(item);
  router.push(`/projects/${item.id}`);
}, [router]);

// 4. å‰Šé™¤ãƒãƒ³ãƒ‰ãƒ©
const handleDelete = useCallback(async (id: string) => {
  if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  
  try {
    await deleteProject(id);
    toast.success('å‰Šé™¤ã—ã¾ã—ãŸ');
    refetch();
  } catch (error) {
    handleError(error);
  }
}, [refetch]);
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²ã
- éåŒæœŸå‡¦ç†ã®é©åˆ‡ãªç®¡ç†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 2-12. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å±¤ã®è©³ç´°
```tsx
// ==========================================
// ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å±¤ï¼ˆJSX returnï¼‰
// ==========================================
return (
  <div className="container mx-auto p-4">
    {/* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
    <header className="mb-6">
      <h1 className="text-2xl font-bold mb-2">Project Details</h1>
      <p className="text-gray-600">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™</p>
    </header>
    
    {/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ */}
    {loading && (
      <div className="flex justify-center items-center py-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      </div>
    )}
    
    {/* ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ */}
    {error && (
      <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
        <p className="text-red-800">{error}</p>
        <Button 
          onClick={() => window.location.reload()} 
          className="mt-2"
          variant="outline"
        >
          å†è©¦è¡Œ
        </Button>
      </div>
    )}
    
    {/* ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º */}
    {data && (
      <div className="space-y-6">
        {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ± */}
        <section className="bg-white rounded-lg shadow p-6">
          <h2 className="text-lg font-semibold mb-4">åŸºæœ¬æƒ…å ±</h2>
          {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´° */}
        </section>
        
        {/* é–¢é€£ãƒ‡ãƒ¼ã‚¿ */}
        <section className="bg-white rounded-lg shadow p-6">
          <h2 className="text-lg font-semibold mb-4">é–¢é€£ãƒ‡ãƒ¼ã‚¿</h2>
          {/* é–¢é€£ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º */}
        </section>
      </div>
    )}
  </div>
);
```

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®è€ƒæ…®
- ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªHTML

## 3. ğŸ“ ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ãƒ«ãƒ¼ãƒ«

### 3-1. ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒºåˆ‡ã‚Šã‚³ãƒ¡ãƒ³ãƒˆ
```tsx
// ==========================================
// ã‚»ã‚¯ã‚·ãƒ§ãƒ³å
// ==========================================
```

### 3-2. æ©Ÿèƒ½èª¬æ˜ã‚³ãƒ¡ãƒ³ãƒˆ
```tsx
// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å–å¾—ã—ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã‚½ãƒ¼ãƒˆã‚’é©ç”¨ã™ã‚‹
const fetchAndProcessProjects = useCallback(async () => {
  // å®Ÿè£…
}, []);
```

### 3-3. è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®ã‚³ãƒ¡ãƒ³ãƒˆ
```tsx
// æ—¥ä»˜ã®æ¯”è¼ƒï¼šéå»ã®æ—¥ä»˜ã¯è² ã®å€¤ã€æœªæ¥ã®æ—¥ä»˜ã¯æ­£ã®å€¤
const daysRemaining = Math.ceil((dueDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
```

### 3-4. TODO/FIXMEã‚³ãƒ¡ãƒ³ãƒˆ
```tsx
// TODO: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã€ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å®Ÿè£…ã™ã‚‹
// FIXME: æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæ­£ã—ãå‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚‹
```

### 3-5. å‹å®šç¾©ã®ã‚³ãƒ¡ãƒ³ãƒˆ
```tsx
/**
 * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸºæœ¬æƒ…å ±
 * @property id - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€æ„è­˜åˆ¥å­
 * @property name - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
 * @property status - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹
 */
interface Project {
  id: string;
  name: string;
  status: ProjectStatus;
}
```

## 4. ğŸ¯ å®Ÿè£…æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å„å±¤ãŒé©åˆ‡ã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆãŒé©åˆ‡ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] å‹å®‰å…¨æ€§ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãŒè€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªHTMLãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] é©åˆ‡ãªçŠ¶æ…‹ç®¡ç†ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹
- [ ] ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒé˜²ãŒã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ†ã‚¹ãƒˆå¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ã‹







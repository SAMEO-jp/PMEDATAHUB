# 開発サーバーポート管理 - 使用方法

## 📋 概要

このプロジェクトでは、開発サーバーを起動する際に、ポート3000の競合を自動的に管理するルールとスクリプトが導入されています。

## 🚀 使用方法

### 方法1: 安全な起動スクリプト（推奨）

```bash
npm run dev:safe
```

このコマンドは以下を自動的に実行します：
1. ✅ 既存プロセスの確認
2. ✅ ポート使用状況の確認
3. ✅ 競合があれば停止（ポート3000の場合は確認）
4. ✅ ポート3000で起動

### 方法2: 通常の起動

```bash
npm run dev
```

**注意**: この方法では自動チェックは行われません。

### 方法3: Cursor AIによる自動管理

Cursor AIに以下のように依頼すると、自動的にポート管理が行われます：
- 「開発サーバーを起動して」
- 「テスト環境を開いて」
- 「サーバーを立ち上げて」
- 「npm run dev して」

CursorのAIは`.cursor/rules/00_settings/dev-server-port-management.mdc`のルールに従い、自動的に：
1. ポート状態を確認
2. 競合があれば対応を提案
3. ポート3000で起動

## 🔧 トラブルシューティング

### 問題: ポートが解放されない

```bash
# すべてのNext.jsプロセスを強制終了
pkill -9 -f "next-server"

# ポート3000を使用しているプロセスを強制終了
kill -9 $(lsof -ti:3000)
```

### 問題: スクリプトが実行できない

```bash
# 実行権限を付与
chmod +x scripts/start-dev-safe.sh

# 直接実行
bash scripts/start-dev-safe.sh
```

## 📝 関連ファイル

- **ルールファイル**: `.cursor/rules/00_settings/dev-server-port-management.mdc`
- **起動スクリプト**: `scripts/start-dev-safe.sh`
- **package.json**: `dev:safe` スクリプトが追加されています

## 🎯 動作の流れ

```
[起動要求]
    ↓
[ポート確認]
    ↓
[競合あり？] ─ No → [ポート3000で起動]
    ↓ Yes
[ポート3000？]
    ↓ Yes → [ユーザーに確認] → [停止] → [ポート3000で起動]
    ↓ No
[自動停止] → [ポート3000で起動]
```

## ✅ ベストプラクティス

1. **常に `npm run dev:safe` を使用する**
   - 自動的にポート管理が行われます
   
2. **Cursor AIに依頼する**
   - 「開発サーバーを起動して」と依頼するだけで自動管理されます

3. **手動起動の場合**
   - 事前にプロセスとポートを確認してから起動してください

## 🔍 確認コマンド

```bash
# 現在動いているNext.jsプロセスを確認
ps aux | grep next-server | grep -v grep

# ポート3000の使用状況を確認
ss -tulpn | grep 3000

# または
lsof -i:3000
```

## 📞 サポート

問題が発生した場合は、以下の情報を提供してください：
1. エラーメッセージ
2. `ps aux | grep next-server` の出力
3. `ss -tulpn | grep 3000` の出力

